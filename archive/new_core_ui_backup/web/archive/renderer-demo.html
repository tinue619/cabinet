<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® Renderer2D Demo - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ó–∏–≥–æ—Ç–∞ v3.1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            background: white;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
        }
        
        .header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .header .version {
            margin-left: auto;
            opacity: 0.8;
            font-size: 0.9rem;
        }
        
        .main-content {
            display: flex;
            width: 100%;
            margin-top: 60px;
        }
        
        .canvas-area {
            flex: 1;
            position: relative;
            background: #f8fafc;
            border-right: 1px solid #e2e8f0;
        }
        
        .canvas-container {
            width: 100%;
            height: calc(100vh - 60px);
            position: relative;
        }
        
        #cabinet-canvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }
        
        .canvas-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            color: #64748b;
            backdrop-filter: blur(10px);
        }
        
        .controls-panel {
            width: 320px;
            background: white;
            padding: 20px;
            overflow-y: auto;
            border-left: 1px solid #e2e8f0;
        }
        
        .control-group {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f8fafc;
        }
        
        .control-group h3 {
            color: #1e293b;
            margin-bottom: 15px;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            border: 1px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        
        .btn-toggle {
            background: #ef4444;
            color: white;
        }
        
        .btn-toggle.active {
            background: #22c55e;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 500;
            color: #64748b;
        }
        
        .info-value {
            font-weight: 600;
            color: #1e293b;
        }
        
        .input-group {
            margin: 10px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #64748b;
            font-weight: 500;
            font-size: 0.85rem;
        }
        
        .input-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-ok {
            background: #22c55e;
        }
        
        .status-warning {
            background: #f59e0b;
        }
        
        .status-error {
            background: #ef4444;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .controls-panel {
                width: 100%;
                height: 200px;
                order: 2;
            }
            
            .canvas-area {
                order: 1;
            }
            
            .canvas-container {
                height: calc(100vh - 260px);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <h1>üé® Renderer2D Demo</h1>
            <div class="version">–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ó–∏–≥–æ—Ç–∞ v3.1</div>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content">
            <!-- –û–±–ª–∞—Å—Ç—å canvas -->
            <div class="canvas-area">
                <div class="canvas-container">
                    <canvas id="cabinet-canvas"></canvas>
                    <div class="canvas-overlay">
                        <div>üñ±Ô∏è –ö–æ–ª–µ—Å–æ –º—ã—à–∏ - –º–∞—Å—à—Ç–∞–±</div>
                        <div>üéØ –ù–∞–≤–µ–¥–µ–Ω–∏–µ - –ø–æ–¥—Å–≤–µ—Ç–∫–∞</div>
                        <div>üìè –ú–∞—Å—à—Ç–∞–±: <span id="scale-display">1.0</span></div>
                    </div>
                </div>
            </div>
            
            <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="controls-panel">
                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                <div class="control-group">
                    <h3>üéõÔ∏è –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h3>
                    <button class="btn btn-toggle active" id="toggle-panels">
                        üìê –ü–∞–Ω–µ–ª–∏
                    </button>
                    <button class="btn btn-toggle active" id="toggle-sections">
                        üì¶ –°–µ–∫—Ü–∏–∏
                    </button>
                    <button class="btn btn-toggle" id="toggle-dimensions">
                        üìè –†–∞–∑–º–µ—Ä—ã
                    </button>
                    <button class="btn btn-secondary" id="reset-scale">
                        üîÑ –°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–±
                    </button>
                </div>
                
                <!-- –°–æ–∑–¥–∞–Ω–∏–µ —à–∫–∞—Ñ–∞ -->
                <div class="control-group">
                    <h3>üèóÔ∏è –®–∫–∞—Ñ</h3>
                    <div class="input-group">
                        <label>–®–∏—Ä–∏–Ω–∞ (–º–º)</label>
                        <input type="number" id="cabinet-width" value="800" min="400" max="2000">
                    </div>
                    <div class="input-group">
                        <label>–í—ã—Å–æ—Ç–∞ (–º–º)</label>
                        <input type="number" id="cabinet-height" value="2000" min="600" max="3000">
                    </div>
                    <div class="input-group">
                        <label>–ì–ª—É–±–∏–Ω–∞ (–º–º)</label>
                        <input type="number" id="cabinet-depth" value="600" min="300" max="800">
                    </div>
                    <button class="btn btn-primary" id="create-cabinet">
                        üÜï –°–æ–∑–¥–∞—Ç—å —à–∫–∞—Ñ
                    </button>
                    <button class="btn btn-secondary" id="random-cabinet">
                        üé≤ –°–ª—É—á–∞–π–Ω—ã–π —à–∫–∞—Ñ
                    </button>
                </div>
                
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —à–∫–∞—Ñ–µ -->
                <div class="control-group">
                    <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <div id="cabinet-info">
                        <div class="info-item">
                            <span class="info-label">–°—Ç–∞—Ç—É—Å:</span>
                            <span class="info-value">
                                <span class="status-indicator status-warning"></span>
                                –ó–∞–≥—Ä—É–∑–∫–∞...
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- –û—Ç–ª–∞–¥–∫–∞ -->
                <div class="control-group">
                    <h3>üêõ –û—Ç–ª–∞–¥–∫–∞</h3>
                    <div id="debug-info">
                        <div class="info-item">
                            <span class="info-label">–†–µ–Ω–¥–µ—Ä–µ—Ä:</span>
                            <span class="info-value">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // –ò–º–ø–æ—Ä—Ç—ã (–∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏ –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏)
        import { quickStart } from '../index.js';
        import { Renderer2D } from '../systems/Renderer2D.js';
        
        console.log('üöÄ Starting Renderer2D Demo...');
        
        let app = {
            result: null,
            renderer: null,
            currentCabinet: null
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        async function initApp() {
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
                updateStatus('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–¥—Ä–∞...', 'warning');
                app.result = quickStart();
                
                // –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞
                updateStatus('–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞...', 'warning');
                const canvas = document.getElementById('cabinet-canvas');
                app.renderer = new Renderer2D(canvas, app.result.system);
                app.renderer.init();
                
                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —à–∫–∞—Ñ–∞
                app.currentCabinet = app.result.cabinet;
                app.renderer.setCabinet(app.currentCabinet);
                
                updateStatus('–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'ok');
                updateCabinetInfo();
                updateDebugInfo();
                
                console.log('‚úÖ Demo initialized successfully');
                
            } catch (error) {
                console.error('‚ùå Demo initialization failed:', error);
                updateStatus('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', 'error');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(text, type = 'ok') {
            const statusEl = document.querySelector('#cabinet-info .info-value');
            if (statusEl) {
                statusEl.innerHTML = `<span class="status-indicator status-${type}"></span>${text}`;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —à–∫–∞—Ñ–µ
        function updateCabinetInfo() {
            if (!app.currentCabinet) return;
            
            const stats = app.currentCabinet.getStats();
            const dims = app.currentCabinet.dimensions;
            
            document.getElementById('cabinet-info').innerHTML = `
                <div class="info-item">
                    <span class="info-label">–°—Ç–∞—Ç—É—Å:</span>
                    <span class="info-value">
                        <span class="status-indicator status-ok"></span>–ê–∫—Ç–∏–≤–µ–Ω
                    </span>
                </div>
                <div class="info-item">
                    <span class="info-label">–†–∞–∑–º–µ—Ä—ã:</span>
                    <span class="info-value">${dims.width}√ó${dims.height}√ó${dims.depth}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">–ü–∞–Ω–µ–ª–µ–π:</span>
                    <span class="info-value">${stats.panelsCount}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">–°–µ–∫—Ü–∏–π:</span>
                    <span class="info-value">${stats.sectionsCount}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">–û–±—ä–µ–º:</span>
                    <span class="info-value">${(stats.volume / 1000000).toFixed(2)} –º¬≥</span>
                </div>
            `;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function updateDebugInfo() {
            if (!app.renderer) return;
            
            const debugInfo = app.renderer.getDebugInfo();
            const transform = debugInfo.transform;
            
            document.getElementById('debug-info').innerHTML = `
                <div class="info-item">
                    <span class="info-label">–†–µ–Ω–¥–µ—Ä–µ—Ä:</span>
                    <span class="info-value">
                        <span class="status-indicator status-ok"></span>–ê–∫—Ç–∏–≤–µ–Ω
                    </span>
                </div>
                <div class="info-item">
                    <span class="info-label">–ú–∞—Å—à—Ç–∞–±:</span>
                    <span class="info-value">${transform.scale.toFixed(2)}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Canvas:</span>
                    <span class="info-value">${debugInfo.canvasSize.width}√ó${debugInfo.canvasSize.height}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">–®–∫–∞—Ñ:</span>
                    <span class="info-value">${debugInfo.hasCabinet ? '–î–∞' : '–ù–µ—Ç'}</span>
                </div>
            `;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –º–∞—Å—à—Ç–∞–±–∞
            document.getElementById('scale-display').textContent = transform.scale.toFixed(2);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —à–∫–∞—Ñ–∞
        function createCabinet() {
            const width = parseInt(document.getElementById('cabinet-width').value);
            const height = parseInt(document.getElementById('cabinet-height').value);
            const depth = parseInt(document.getElementById('cabinet-depth').value);
            
            if (width < 400 || width > 2000 || 
                height < 600 || height > 3000 || 
                depth < 300 || depth > 800) {
                alert('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä—ã —à–∫–∞—Ñ–∞!');
                return;
            }
            
            try {
                updateStatus('–°–æ–∑–¥–∞–Ω–∏–µ —à–∫–∞—Ñ–∞...', 'warning');
                
                const newCabinet = app.result.system.createCabinet({
                    width,
                    height,
                    depth,
                    baseHeight: 100
                });
                
                newCabinet.generate();
                app.currentCabinet = newCabinet;
                app.renderer.setCabinet(newCabinet);
                
                updateStatus('–®–∫–∞—Ñ —Å–æ–∑–¥–∞–Ω', 'ok');
                updateCabinetInfo();
                updateDebugInfo();
                
                console.log('‚úÖ New cabinet created:', newCabinet.getStats());
                
            } catch (error) {
                console.error('‚ùå Cabinet creation failed:', error);
                updateStatus('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è', 'error');
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —à–∫–∞—Ñ–∞
        function createRandomCabinet() {
            const width = 600 + Math.random() * 800; // 600-1400
            const height = 1800 + Math.random() * 600; // 1800-2400
            const depth = 400 + Math.random() * 300; // 400-700
            
            document.getElementById('cabinet-width').value = Math.round(width);
            document.getElementById('cabinet-height').value = Math.round(height);
            document.getElementById('cabinet-depth').value = Math.round(depth);
            
            createCabinet();
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('toggle-panels').onclick = function() {
            const isActive = this.classList.contains('active');
            app.renderer.setRenderOptions({ showPanels: !isActive });
            this.classList.toggle('active');
            updateDebugInfo();
        };
        
        document.getElementById('toggle-sections').onclick = function() {
            const isActive = this.classList.contains('active');
            app.renderer.setRenderOptions({ showSections: !isActive });
            this.classList.toggle('active');
            updateDebugInfo();
        };
        
        document.getElementById('toggle-dimensions').onclick = function() {
            const isActive = this.classList.contains('active');
            app.renderer.showDimensions(!isActive);
            this.classList.toggle('active');
            updateDebugInfo();
        };
        
        document.getElementById('reset-scale').onclick = () => {
            app.renderer.resetScale();
            updateDebugInfo();
        };
        
        document.getElementById('create-cabinet').onclick = createCabinet;
        document.getElementById('random-cabinet').onclick = createRandomCabinet;
        
        // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        setInterval(updateDebugInfo, 1000);
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        initApp();
        
    </script>
</body>
</html>
