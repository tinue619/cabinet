<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø: –ü–µ—Ä–µ–¥–Ω–∏–π —Ü–æ–∫–æ–ª—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω!</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .header {
            text-align: center;
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 2.5em;
        }
        
        .header p {
            margin: 0;
            color: #7f8c8d;
            font-size: 1.2em;
        }
        
        .demo-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .demo-panel {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .demo-panel h2 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        
        .before { border-left: 5px solid #e74c3c; }
        .after { border-left: 5px solid #27ae60; }
        
        .results-container {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            font-family: 'Consolas', monospace;
            font-size: 14px;
        }
        
        .success { border-color: #28a745; background: #d4edda; color: #155724; }
        .error { border-color: #dc3545; background: #f8d7da; color: #721c24; }
        .warning { border-color: #ffc107; background: #fff3cd; color: #856404; }
        .info { border-color: #17a2b8; background: #d1ecf1; color: #0c5460; }
        
        canvas {
            border: 2px solid #bdc3c7;
            background: #ffffff;
            border-radius: 8px;
            width: 100%;
            max-width: 500px;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        
        .formula-comparison {
            background: #e8f4fd;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Consolas', monospace;
        }
        
        .formula-comparison h3 {
            margin: 0 0 15px 0;
            color: #2980b9;
        }
        
        .formula-line {
            margin: 8px 0;
            padding: 5px;
            border-radius: 4px;
        }
        
        .formula-before {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        
        .formula-after {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
        }
        
        .highlight-red { color: #e74c3c; font-weight: bold; }
        .highlight-green { color: #27ae60; font-weight: bold; }
        
        @media (max-width: 768px) {
            .demo-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ –ö–ê–ë–ò–ù–ï–¢ –î–ò–ó–ê–ô–ù–ï–†</h1>
        <p>–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥–Ω–µ–≥–æ —Ü–æ–∫–æ–ª—è v3.1.0</p>
    </div>

    <div class="formula-comparison">
        <h3>üìê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö CABINET_DNA:</h3>
        
        <div class="formula-line formula-before">
            <strong>‚ùå –ë–´–õ–û (–ø–æ–∑–∏—Ü–∏—è):</strong> FRONT_BASE: y: 0 (–≤–≤–µ—Ä—Ö—É)
        </div>
        <div class="formula-line formula-after">
            <strong>‚úÖ –°–¢–ê–õ–û (–ø–æ–∑–∏—Ü–∏—è):</strong> FRONT_BASE: y: y - b (–≤–Ω–∏–∑—É)
        </div>
        
        <div class="formula-line formula-before">
            <strong>‚ùå –ë–´–õ–û (—Ä–∞–∑–º–µ—Ä):</strong> { width: y - 2*t, height: t, depth: z }
        </div>
        <div class="formula-line formula-after">
            <strong>‚úÖ –°–¢–ê–õ–û (—Ä–∞–∑–º–µ—Ä):</strong> { width: x - 2*t, height: b, depth: t }
        </div>
    </div>

    <div class="demo-container">
        <div class="demo-panel before">
            <h2>‚ùå –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
            <canvas id="canvasBefore" width="400" height="300"></canvas>
            <p style="text-align: center; margin-top: 15px; color: #e74c3c;">
                –¶–æ–∫–æ–ª—å –±—ã–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –≤–≤–µ—Ä—Ö—É
            </p>
        </div>
        
        <div class="demo-panel after">
            <h2>‚úÖ –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
            <canvas id="canvasAfter" width="400" height="300"></canvas>
            <p style="text-align: center; margin-top: 15px; color: #27ae60;">
                –¶–æ–∫–æ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –≤–Ω–∏–∑—É –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
            </p>
        </div>
    </div>

    <div class="results-container">
        <h2>üî¨ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h2>
        <div id="results"></div>
    </div>

    <script type="module">
        // üèóÔ∏è UI LAYER - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥–Ω–µ–≥–æ —Ü–æ–∫–æ–ª—è
        // –¢–û–õ–¨–ö–û –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –ë–ï–ó –ª–æ–≥–∏–∫–∏

        let results = document.getElementById('results');
        let canvasBefore = document.getElementById('canvasBefore');
        let canvasAfter = document.getElementById('canvasAfter');
        let ctxBefore = canvasBefore.getContext('2d');
        let ctxAfter = canvasAfter.getContext('2d');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            results.appendChild(div);
            console.log(message);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ "–î–û" (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è)
        function drawBeforeVersion(ctx, dimensions) {
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            
            const scale = Math.min(
                (ctx.canvas.width - 80) / dimensions.width,
                (ctx.canvas.height - 80) / dimensions.height
            );
            
            const offsetX = (ctx.canvas.width - dimensions.width * scale) / 2;
            const offsetY = (ctx.canvas.height - dimensions.height * scale) / 2;

            // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (—Å—Ç–∞—Ä—ã–µ —Ñ–æ—Ä–º—É–ª—ã)
            const t = 16;  // —Ç–æ–ª—â–∏–Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
            const b = 100; // –≤—ã—Å–æ—Ç–∞ —Ü–æ–∫–æ–ª—è
            
            // –°–¢–ê–†–´–ï —Ñ–æ—Ä–º—É–ª—ã (–∫–∞–∫ –±—ã–ª–æ)
            const frontBaseOld = {
                position: { x: t, y: 0, z: dimensions.depth - t }, // y: 0 - –≤–≤–µ—Ä—Ö—É!
                size: { width: dimensions.height - 2*t, height: t, depth: dimensions.depth } // –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
            };

            // –ö–æ–Ω—Ç—É—Ä —à–∫–∞—Ñ–∞
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            ctx.strokeRect(offsetX, offsetY, dimensions.width * scale, dimensions.height * scale);

            // –ü–µ—Ä–µ–¥–Ω–∏–π —Ü–æ–∫–æ–ª—å (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –≤–≤–µ—Ä—Ö—É)
            const x = offsetX + frontBaseOld.position.x * scale;
            const y = offsetY + frontBaseOld.position.y * scale; // y = 0
            const w = Math.min(frontBaseOld.size.width * scale, dimensions.width * scale - 2*t*scale);
            const h = frontBaseOld.size.height * scale;

            ctx.fillStyle = '#ff6b6b';
            ctx.fillRect(x, y, w, h);
            ctx.strokeStyle = '#c0392b';
            ctx.lineWidth = 1;
            ctx.strokeRect(x, y, w, h);

            // –ü–æ–¥–ø–∏—Å—å
            ctx.fillStyle = '#2c3e50';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('–¶–û–ö–û–õ–¨ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û)', x + w/2, y + h/2);
            
            // –°—Ç—Ä–µ–ª–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∞—è –ø—Ä–æ–±–ª–µ–º—É
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x + w + 10, y);
            ctx.lineTo(x + w + 30, y - 20);
            ctx.stroke();
            
            ctx.fillStyle = '#e74c3c';
            ctx.font = '10px Arial';
            ctx.fillText('–í–≤–µ—Ä—Ö—É!', x + w + 35, y - 15);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ "–ü–û–°–õ–ï" (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
        function drawAfterVersion(ctx, dimensions, cabinet) {
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            
            const scale = Math.min(
                (ctx.canvas.width - 80) / dimensions.width,
                (ctx.canvas.height - 80) / dimensions.height
            );
            
            const offsetX = (ctx.canvas.width - dimensions.width * scale) / 2;
            const offsetY = (ctx.canvas.height - dimensions.height * scale) / 2;

            // –ö–æ–Ω—Ç—É—Ä —à–∫–∞—Ñ–∞
            ctx.strokeStyle = '#27ae60';
            ctx.lineWidth = 2;
            ctx.strokeRect(offsetX, offsetY, dimensions.width * scale, dimensions.height * scale);

            // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–¥–Ω–∏–π —Ü–æ–∫–æ–ª—å
            const frontBase = cabinet.getPanel('FRONT_BASE');
            if (frontBase) {
                const pos = frontBase.position;
                const size = frontBase.dimensions;
                
                const x = offsetX + pos.x * scale;
                const y = offsetY + pos.y * scale; // —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–Ω–∏–∑—É
                const w = size.width * scale;
                const h = size.height * scale;

                ctx.fillStyle = '#2ecc71';
                ctx.fillRect(x, y, w, h);
                ctx.strokeStyle = '#229954';
                ctx.lineWidth = 1;
                ctx.strokeRect(x, y, w, h);

                // –ü–æ–¥–ø–∏—Å—å
                ctx.fillStyle = '#2c3e50';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('–¶–û–ö–û–õ–¨ (–ü–†–ê–í–ò–õ–¨–ù–û)', x + w/2, y + h/2);
                
                // –°—Ç—Ä–µ–ª–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∞—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                ctx.strokeStyle = '#27ae60';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(x + w + 10, y + h);
                ctx.lineTo(x + w + 30, y + h + 20);
                ctx.stroke();
                
                ctx.fillStyle = '#27ae60';
                ctx.font = '10px Arial';
                ctx.fillText('–í–Ω–∏–∑—É!', x + w + 35, y + h + 25);
            }
        }

        async function runDemo() {
            try {
                log('üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥–Ω–µ–≥–æ —Ü–æ–∫–æ–ª—è...', 'info');

                // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —è–¥—Ä–æ
                const { Cabinet } = await import('./new_core/entities/Cabinet.js');
                const { CABINET_DNA } = await import('./new_core/cabinet-dna.js');
                
                log(`‚úÖ –Ø–¥—Ä–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ, –≤–µ—Ä—Å–∏—è –î–ù–ö: ${CABINET_DNA.SIGNATURE.version}`, 'success');

                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —à–∫–∞—Ñ
                const cabinet = new Cabinet({
                    width: 800,
                    height: 2000,
                    depth: 600,
                    baseHeight: 100
                });

                log(`üèóÔ∏è –®–∫–∞—Ñ —Å–æ–∑–¥–∞–Ω: ${cabinet.dimensions.width}√ó${cabinet.dimensions.height}√ó${cabinet.dimensions.depth}`, 'success');

                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–∞–Ω–µ–ª–∏
                cabinet.generate();
                const stats = cabinet.getStats();
                log(`‚öôÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${stats.panelsCount} –ø–∞–Ω–µ–ª–µ–π`, 'success');

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–¥–Ω–∏–π —Ü–æ–∫–æ–ª—å
                const frontBase = cabinet.getPanel('FRONT_BASE');
                if (!frontBase) {
                    log('‚ùå –ü–µ—Ä–µ–¥–Ω–∏–π —Ü–æ–∫–æ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
                    return;
                }

                log(`‚úÖ –ü–µ—Ä–µ–¥–Ω–∏–π —Ü–æ–∫–æ–ª—å –Ω–∞–π–¥–µ–Ω: ${frontBase.name}`, 'success');

                // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                const dims = cabinet.dimensions;
                const t = cabinet.materialThickness;
                const b = dims.baseHeight;
                
                const expectedY = dims.height - b; // 2000 - 100 = 1900
                const actualY = frontBase.position.y;
                
                if (actualY === expectedY) {
                    log(`‚úÖ –ü–û–ó–ò–¶–ò–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ê: –¶–æ–∫–æ–ª—å —Ç–µ–ø–µ—Ä—å –≤–Ω–∏–∑—É (y=${actualY})`, 'success');
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∑–∏—Ü–∏–∏: –æ–∂–∏–¥–∞–ª–æ—Å—å y=${expectedY}, –ø–æ–ª—É—á–µ–Ω–æ y=${actualY}`, 'error');
                }

                // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä—ã
                const expectedWidth = dims.width - 2*t; // 800 - 32 = 768
                const expectedHeight = b; // 100
                const expectedDepth = t; // 16
                
                const actualSize = frontBase.dimensions;
                
                const sizeCorrect = (
                    actualSize.width === expectedWidth &&
                    actualSize.height === expectedHeight &&
                    actualSize.depth === expectedDepth
                );
                
                if (sizeCorrect) {
                    log(`‚úÖ –†–ê–ó–ú–ï–†–´ –ò–°–ü–†–ê–í–õ–ï–ù–´: ${actualSize.width}√ó${actualSize.height}√ó${actualSize.depth}`, 'success');
                } else {
                    log(`‚ùå –û—à–∏–±–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤: –æ–∂–∏–¥–∞–ª–æ—Å—å ${expectedWidth}√ó${expectedHeight}√ó${expectedDepth}`, 'error');
                    log(`   –ø–æ–ª—É—á–µ–Ω–æ ${actualSize.width}√ó${actualSize.height}√ó${actualSize.depth}`, 'error');
                }

                // –†–∏—Å—É–µ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é
                log('üé® –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—É—é –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é...', 'info');
                
                drawBeforeVersion(ctxBefore, cabinet.dimensions);
                drawAfterVersion(ctxAfter, cabinet.dimensions, cabinet);
                
                log('üéâ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!', 'success');
                log(`üìã –ò—Ç–æ–≥: –ü–µ—Ä–µ–¥–Ω–∏–π —Ü–æ–∫–æ–ª—å —Ç–µ–ø–µ—Ä—å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –í–ù–ò–ó–£ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã, –∫–∞–∫ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–ª–æ—Å—å`, 'info');

            } catch (error) {
                log(`üí• –û—à–∏–±–∫–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏: ${error.message}`, 'error');
                console.error('Demo error:', error);
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é
        runDemo();

    </script>
</body>
</html>