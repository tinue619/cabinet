<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ö° –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .header {
            text-align: center;
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 2.5em;
        }
        
        .performance-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .performance-panel {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .heavy-version {
            border-left: 5px solid #e74c3c;
        }
        
        .light-version {
            border-left: 5px solid #2ecc71;
        }
        
        .results-container {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            margin: 8px 0;
            font-family: 'Consolas', monospace;
            font-size: 14px;
        }
        
        .success { border-color: #28a745; background: #d4edda; color: #155724; }
        .error { border-color: #dc3545; background: #f8d7da; color: #721c24; }
        .info { border-color: #17a2b8; background: #d1ecf1; color: #0c5460; }
        .warning { border-color: #ffc107; background: #fff3cd; color: #856404; }
        
        canvas {
            border: 2px solid #bdc3c7;
            background: #ffffff;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            height: 300px;
            display: block;
            margin: 10px auto;
        }
        
        .benchmark-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        
        .benchmark-button:hover {
            background: #2980b9;
        }
        
        .benchmark-button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        
        .timing-result {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
        }
        
        .timing-fast {
            background: #d4edda;
            color: #155724;
        }
        
        .timing-slow {
            background: #f8d7da;
            color: #721c24;
        }
        
        @media (max-width: 768px) {
            .performance-comparison {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚ö° –¢–ï–°–¢ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò</h1>
        <p>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ–±—ã—á–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã vs –ª–µ–≥–∫–æ–≤–µ—Å–Ω–æ–≥–æ –∞–¥–∞–ø—Ç–µ—Ä–∞</p>
    </div>

    <div class="performance-comparison">
        <div class="performance-panel heavy-version">
            <h2>üêå –û–±—ã—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h2>
            <p><strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</strong></p>
            <ul>
                <li>ArchitecturalBase –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏</li>
                <li>ArchitecturalGuardian –≤–∞–ª–∏–¥–∞—Ü–∏—è</li>
                <li>Object.freeze() –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö</li>
                <li>–°–ª–æ–∂–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –æ–±—ä–µ–∫—Ç–æ–≤</li>
                <li>Event system —Å Map'–∞–º–∏</li>
            </ul>
            <canvas id="heavyCanvas"></canvas>
            <div id="heavyTiming" class="timing-result">–ù–µ –∏–∑–º–µ—Ä–µ–Ω–æ</div>
            <button id="heavyBtn" class="benchmark-button" disabled>–¢–µ—Å—Ç –æ–±—ã—á–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã</button>
        </div>
        
        <div class="performance-panel light-version">
            <h2>üöÄ –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä</h2>
            <p><strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</strong></p>
            <ul>
                <li>–ü—Ä–æ—Å—Ç—ã–µ JavaScript –æ–±—ä–µ–∫—Ç—ã</li>
                <li>–ú–∏–Ω–∏–º—É–º –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏</li>
                <li>–ü—Ä—è–º–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –±–µ–∑ –≥–µ—Ç—Ç–µ—Ä–æ–≤</li>
                <li>–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã</li>
                <li>–î–∞–Ω–Ω—ã–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –∑–∞—Ä–∞–Ω–µ–µ</li>
            </ul>
            <canvas id="lightCanvas"></canvas>
            <div id="lightTiming" class="timing-result">–ù–µ –∏–∑–º–µ—Ä–µ–Ω–æ</div>
            <button id="lightBtn" class="benchmark-button" disabled>–¢–µ—Å—Ç –ª–µ–≥–∫–æ–≤–µ—Å–Ω–æ–≥–æ –∞–¥–∞–ø—Ç–µ—Ä–∞</button>
        </div>
    </div>

    <div class="results-container">
        <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–Ω—á–º–∞—Ä–∫–æ–≤:</h2>
        <div id="results"></div>
        
        <div style="text-align: center; margin-top: 20px;">
            <button id="runAllBtn" class="benchmark-button" style="background: #2ecc71;" disabled>–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
        </div>
    </div>

    <script type="module">
        // üèóÔ∏è UI LAYER - –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        // –¢–û–õ–¨–ö–û –∏–∑–º–µ—Ä–µ–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –ë–ï–ó –ª–æ–≥–∏–∫–∏

        let results = document.getElementById('results');
        let heavyCanvas = document.getElementById('heavyCanvas');
        let lightCanvas = document.getElementById('lightCanvas');
        let heavyCtx = heavyCanvas.getContext('2d');
        let lightCtx = lightCanvas.getContext('2d');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            results.appendChild(div);
            console.log(message);
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
        let cabinet = null;
        let lightweightCabinet = null;

        // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ –ø–∞–Ω–µ–ª–∏
        function getColorForPanel(key) {
            const colors = {
                'LEFT_SIDE': '#3498db',
                'RIGHT_SIDE': '#9b59b6', 
                'TOP': '#e74c3c',
                'BOTTOM': '#f39c12',
                'FRONT_BASE': '#2ecc71',
                'BACK_BASE': '#34495e',
                'BACK_WALL': '#f1c40f',
                'FACADE': '#95a5a6'
            };
            return colors[key] || '#bdc3c7';
        }

        async function initializeTestData() {
            try {
                log('üì¶ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...', 'info');

                // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —è–¥—Ä–æ –∏ –∞–¥–∞–ø—Ç–µ—Ä
                const { Cabinet } = await import('./new_core/entities/Cabinet.js');
                const { LightweightCabinetAdapter } = await import('./new_core/adapters/LightweightCabinetAdapter.js');
                
                // –°–æ–∑–¥–∞–µ–º –ø–æ–ª–Ω—ã–π —à–∫–∞—Ñ
                cabinet = new Cabinet({
                    width: 800,
                    height: 2000,
                    depth: 600,
                    baseHeight: 100
                });
                
                cabinet.generate();
                
                // –°–æ–∑–¥–∞–µ–º –ª–µ–≥–∫–æ–≤–µ—Å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
                lightweightCabinet = LightweightCabinetAdapter.createLightweightRepresentation(cabinet);
                
                log('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã', 'success');
                log(`üìä –°–æ–∑–¥–∞–Ω–æ –ø–∞–Ω–µ–ª–µ–π: ${lightweightCabinet.panels.length}`, 'info');
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
                document.getElementById('heavyBtn').disabled = false;
                document.getElementById('lightBtn').disabled = false;
                document.getElementById('runAllBtn').disabled = false;
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
                console.error('Init error:', error);
            }
        }

        async function benchmarkHeavyArchitecture() {
            if (!cabinet) return;
            
            log('üêå –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–∞ –æ–±—ã—á–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã...', 'info');
            
            const iterations = 50; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–æ–∫
            
            const startTime = performance.now();
            
            for (let i = 0; i < iterations; i++) {
                // –ò–º–∏—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
                heavyCtx.clearRect(0, 0, heavyCanvas.width, heavyCanvas.height);
                
                const dims = cabinet.dimensions; // –ß–µ—Ä–µ–∑ –≥–µ—Ç—Ç–µ—Ä
                const panels = cabinet.getPanels(); // –ß–µ—Ä–µ–∑ –º–µ—Ç–æ–¥
                
                // –†–∞—Å—á–µ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
                const scale = Math.min(
                    (heavyCanvas.width - 50) / dims.width,
                    (heavyCanvas.height - 50) / dims.height
                );
                const offsetX = (heavyCanvas.width - dims.width * scale) / 2;
                const offsetY = (heavyCanvas.height - dims.height * scale) / 2;
                
                // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥—ã –æ–±—ä–µ–∫—Ç–æ–≤
                panels.forEach(panel => {
                    const pos = panel.position; // –ß–µ—Ä–µ–∑ –≥–µ—Ç—Ç–µ—Ä
                    const size = panel.dimensions; // –ß–µ—Ä–µ–∑ –≥–µ—Ç—Ç–µ—Ä
                    
                    const x = offsetX + pos.x * scale;
                    const y = offsetY + pos.y * scale;
                    const w = size.width * scale;
                    const h = size.height * scale;
                    
                    heavyCtx.fillStyle = getColorForPanel(panel.key);
                    heavyCtx.fillRect(x, y, w, h);
                    heavyCtx.strokeStyle = '#333';
                    heavyCtx.strokeRect(x, y, w, h);
                });
            }
            
            const endTime = performance.now();
            const totalTime = endTime - startTime;
            const avgTime = totalTime / iterations;
            
            document.getElementById('heavyTiming').textContent = `${totalTime.toFixed(2)}–º—Å (${avgTime.toFixed(2)}–º—Å/–∫–∞–¥—Ä)`;
            document.getElementById('heavyTiming').className = 'timing-result timing-slow';
            
            log(`üêå –û–±—ã—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: ${totalTime.toFixed(2)}–º—Å –∑–∞ ${iterations} –∫–∞–¥—Ä–æ–≤`, 'warning');
            
            return totalTime;
        }

        async function benchmarkLightweightAdapter() {
            if (!lightweightCabinet) return;
            
            log('üöÄ –ó–∞–ø—É—Å–∫ –±–µ–Ω—á–º–∞—Ä–∫–∞ –ª–µ–≥–∫–æ–≤–µ—Å–Ω–æ–≥–æ –∞–¥–∞–ø—Ç–µ—Ä–∞...', 'info');
            
            const iterations = 50; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–æ–∫
            const { LightweightCabinetAdapter } = await import('./new_core/adapters/LightweightCabinetAdapter.js');
            
            const startTime = performance.now();
            
            for (let i = 0; i < iterations; i++) {
                lightCtx.clearRect(0, 0, lightCanvas.width, lightCanvas.height);
                
                // –†–∞—Å—á–µ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
                const transform = LightweightCabinetAdapter.calculateOptimalTransform(
                    lightweightCabinet, 
                    lightCanvas.width, 
                    lightCanvas.height, 
                    25
                );
                
                // –ë—ã—Å—Ç—Ä–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
                LightweightCabinetAdapter.renderLightweight(lightCtx, lightweightCabinet, transform);
            }
            
            const endTime = performance.now();
            const totalTime = endTime - startTime;
            const avgTime = totalTime / iterations;
            
            document.getElementById('lightTiming').textContent = `${totalTime.toFixed(2)}–º—Å (${avgTime.toFixed(2)}–º—Å/–∫–∞–¥—Ä)`;
            document.getElementById('lightTiming').className = 'timing-result timing-fast';
            
            log(`üöÄ –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä: ${totalTime.toFixed(2)}–º—Å –∑–∞ ${iterations} –∫–∞–¥—Ä–æ–≤`, 'success');
            
            return totalTime;
        }

        async function runAllBenchmarks() {
            log('üèÅ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏...', 'info');
            
            const heavyTime = await benchmarkHeavyArchitecture();
            const lightTime = await benchmarkLightweightAdapter();
            
            if (heavyTime && lightTime) {
                const improvement = ((heavyTime - lightTime) / heavyTime * 100).toFixed(1);
                const speedup = (heavyTime / lightTime).toFixed(1);
                
                log(`üìà –†–ï–ó–£–õ–¨–¢–ê–¢–´ –°–†–ê–í–ù–ï–ù–ò–Ø:`, 'success');
                log(`   –û–±—ã—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: ${heavyTime.toFixed(2)}–º—Å`, 'info');
                log(`   –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä: ${lightTime.toFixed(2)}–º—Å`, 'info');
                log(`   –£—Å–∫–æ—Ä–µ–Ω–∏–µ: –≤ ${speedup}x —Ä–∞–∑`, 'success');
                log(`   –£–ª—É—á—à–µ–Ω–∏–µ: ${improvement}%`, 'success');
                
                if (parseFloat(speedup) > 2) {
                    log(`üéâ –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏!`, 'success');
                } else {
                    log(`‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞`, 'info');
                }
            }
        }

        // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('heavyBtn').addEventListener('click', benchmarkHeavyArchitecture);
        document.getElementById('lightBtn').addEventListener('click', benchmarkLightweightAdapter);
        document.getElementById('runAllBtn').addEventListener('click', runAllBenchmarks);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        initializeTestData();

    </script>
</body>
</html>